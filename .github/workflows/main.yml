name: Combined Workflow - Game Simulation and Tailscale

on:
  push:
    branches:
      - main

jobs:
  game-simulation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Build Docker image (Game)
        run: docker build -t my-game-env .

      - name: Run game simulation
        run: docker run my-game-env

  tailscale-connect:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --auth-key=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=github-actions-runner

      - name: Test Connection
        run: |
          # Reemplaza <IP_DE_TU_MAQUINA> con la IP de Tailscale de tu m√°quina virtual
          ping -c 3 <IP_DE_TU_MAQUINA>
